<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Forgot Password - JobPortal</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
      crossorigin="anonymous" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap"
      rel="stylesheet" />
    <link rel="stylesheet" href="/style/base.css" />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg custom-navbar fixed-top">
      <div class="container">
        <a class="navbar-brand fw-bold" href="/index.html">
          <img src="/images/job-logo.png" alt="Job Portal Logo" />
        </a>

        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#mainNavbar"
          aria-controls="mainNavbar"
          aria-expanded="false"
          aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="mainNavbar">
          <ul class="navbar-nav mb-2 mb-lg-0 gap-lg-3">
            <li class="nav-item">
              <a class="nav-link" href="/index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/jobs.html">Jobs</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/companies.html">Companies</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/about.html">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/contact.html">Contact</a>
            </li>
            <li id="navAuth">
              <a href="/signup.html" class="btn btn-md btn-signup">Sign Up</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <main class="main">
      <section class="home-jobs" style="padding: 60px 0">
        <div class="container" style="max-width: 520px">
          <div class="card border-0 shadow-sm">
            <div class="card-body p-4 p-md-5">
              <!-- Request Reset Form -->
              <div id="requestForm">
                <span class="badge badge-accent mb-2 px-3 py-2 rounded-pill">
                  <i class="fa-solid fa-key me-1"></i> Password Reset
                </span>
                <h2 class="mb-2" style="font-weight: 700">
                  Forgot your password?
                </h2>
                <p class="text-muted mb-4">
                  Enter your email address and we'll send you instructions to
                  reset your password.
                </p>

                <div id="formAlert" class="alert d-none" role="alert"></div>

                <form id="resetRequestForm" novalidate>
                  <div class="mb-3">
                    <label for="email" class="form-label">Email Address</label>
                    <input
                      id="email"
                      name="email"
                      type="email"
                      class="form-control"
                      placeholder="you@example.com"
                      autocomplete="email"
                      required />
                  </div>

                  <button
                    id="submitBtn"
                    type="submit"
                    class="btn btn-signup w-100">
                    <i class="fa-solid fa-paper-plane me-2"></i> Send Reset Link
                  </button>
                </form>

                <p class="mt-4 mb-0 text-center">
                  Remember your password?
                  <a
                    href="/signin.html"
                    style="color: #b71c1c; font-weight: 600"
                    >Sign In</a
                  >
                </p>
              </div>

              <!-- Success Message -->
              <div id="successMessage" class="d-none text-center">
                <div class="mb-4">
                  <div
                    style="
                      width: 80px;
                      height: 80px;
                      background: rgba(76, 175, 80, 0.1);
                      border-radius: 50%;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      margin: 0 auto;
                    ">
                    <i
                      class="fa-solid fa-envelope-circle-check"
                      style="font-size: 2rem; color: #4caf50"></i>
                  </div>
                </div>
                <h3 class="mb-2" style="font-weight: 700">Check your email</h3>
                <p class="text-muted mb-4">
                  If an account exists with this email, you will receive
                  password reset instructions.
                </p>

                <!-- Demo: Show reset link (in production, this would be sent via email) -->
                <div id="demoResetLink" class="d-none alert text-start">
                  <a
                    id="resetLink"
                    href="#"
                    class="d-block mt-2 btn btn-md btn-signup"
                    >Reset Password</a
                  >
                </div>

                <a href="/signin.html" class="btn btn-signup">
                  <i class="fa-solid fa-arrow-left me-2"></i> Back to Sign In
                </a>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script
      src="https://kit.fontawesome.com/9f730657c2.js"
      crossorigin="anonymous"></script>

    <script type="module">
      import { requestPasswordReset, redirectIfAuthed } from "/js/auth.js";

      redirectIfAuthed({ to: "/dashboard/index.html" });

      const requestFormContainer = document.getElementById("requestForm");
      const successMessage = document.getElementById("successMessage");
      const form = document.getElementById("resetRequestForm");
      const alertBox = document.getElementById("formAlert");
      const submitBtn = document.getElementById("submitBtn");
      const demoResetLink = document.getElementById("demoResetLink");
      const resetLink = document.getElementById("resetLink");

      function showAlert(type, message) {
        alertBox.classList.remove("d-none", "alert-danger", "alert-success");
        alertBox.classList.add(
          type === "success" ? "alert-success" : "alert-danger"
        );
        alertBox.textContent = message;
      }

      form.addEventListener("submit", (e) => {
        e.preventDefault();
        submitBtn.disabled = true;

        const email = document.getElementById("email").value;
        const res = requestPasswordReset(email);

        if (res.ok) {
          requestFormContainer.classList.add("d-none");
          successMessage.classList.remove("d-none");

          if (res.token) {
            demoResetLink.classList.remove("d-none");
            resetLink.href = `/reset-password.html?token=${res.token}`;
          }
        } else {
          showAlert("error", res.message);
          submitBtn.disabled = false;
        }
      });
    </script>
  </body>
</html>
